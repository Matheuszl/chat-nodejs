<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chat web</title>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.1.2/socket.io.js"></script>

  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <form id="chat">
    <div class="messages"></div>
    <input class="user-name" type="text" name="username" placeholder="Nome de usuario"></input>
    <input class="user-message" type="text" name="message" placeholder="Digite sua mensagem"></input>
    <button class="send" type="submit">Enviar</button>
    <!-- <button class="send" onclick="run()">Enviar</button> -->

  </form>

  <script type="text/javascript">
    var socket = io('http://15.228.28.56:4200');

    function renderMessage(message) {
      $('.messages').append('<div class="message"><strong>' + message.autor + '</strong>:' + message.message + '</div>');
    }

    socket.on('previousMessage', function (messages) {
      for (message of messages) {
        renderMessage(message);
      }
    });


    socket.on('receivedMessage', function (message) {
      renderMessage(message);
    });

    $('#chat').submit(function (event) {
      event.preventDefault();
      let messagefield = document.querySelector('.user-message')
      let namefield = document.querySelector('.user-name')
      let messagesfield = document.querySelector(".messages")

      if (namefield.value.length && messagefield.value.length) {
        var messageObject = {
          autor: namefield.value,
          message: messagefield.value,
        };

        renderMessage(messageObject);

        socket.emit('sendMessage', messageObject);
        // namefield.value = ""
        messagefield.value = " "
        let messages = document.getElementsByClassName("message")
        console.log(messages.length);
        messagesfield.scroll(0, (messages.length * 1000))
        
      }
    });






  </script>
</body>

</html>